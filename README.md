# .NET 6 API - Dockerized with TLS Fix for Legacy SQL Server

This is a .NET 6 ASP.NET Core Web API project, containerized with Docker and configured to connect to older SQL Server instances that don't support TLS 1.2+.

## Prerequisites

- .NET 6 SDK
- Docker & Docker Compose

## Quick Start

```bash
# Build and run
docker compose up --build

# Access the API
curl http://localhost:8080/api/hello
curl http://localhost:8080/api/health
```

## Project Structure

```
├── Controllers/
│   ├── HelloController.cs        # Sample hello world endpoint
│   ├── HealthController.cs       # Health check endpoint
│   └── DatabaseController.cs     # SQL Server connection test endpoints
├── Data/
│   └── AppDbContext.cs           # Entity Framework DbContext
├── Models/
│   └── TestEntity.cs             # Sample database entity
├── Program.cs                    # Application entry point
├── appsettings.json              # Configuration
├── Dockerfile                    # Multi-stage build with TLS fix
├── docker-compose.yml            # Production config
├── docker-compose.override.yml   # Development overrides
├── .gitignore
└── .dockerignore
```

## TLS Fix Explanation

### The Problem

Modern Linux distributions (like Debian Bullseye, which backs the .NET 6 Docker images) ship with OpenSSL configured to enforce **TLS 1.2 minimum** by default. This causes connection failures when trying to connect to older SQL Server instances (SQL Server 2008/2012) that only support TLS 1.0 or TLS 1.1.

Error you might see without this fix:
```
A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: SSL Provider, error: 0 - The certificate received from the server was issued by an untrusted issuer.)
```

### The Fix

The Dockerfile modifies `/etc/ssl/openssl.cnf` to allow legacy TLS protocols:

```dockerfile
RUN sed -i 's/\[openssl_init\]/# [openssl_init]/' /etc/ssl/openssl.cnf
RUN printf "\n\n[openssl_init]\nssl_conf = ssl_sect" >> /etc/ssl/openssl.cnf
RUN printf "\n\n[ssl_sect]\nsystem_default = ssl_default_sect" >> /etc/ssl/openssl.cnf
RUN printf "\n\n[ssl_default_sect]\nMinProtocol = TLSv1\nCipherString = DEFAULT@SECLEVEL=0\n" >> /etc/ssl/openssl.cnf
```

This configuration:
- **MinProtocol = TLSv1** - Allows TLS 1.0, 1.1, and 1.2
- **CipherString = DEFAULT@SECLEVEL=0** - Allows weaker ciphers for legacy compatibility

## Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/hello` | Hello World endpoint |
| GET | `/api/health` | Health check endpoint |
| GET | `/api/database/health` | Test SQL Server database connection |
| POST | `/api/database/seed` | Seed test data into the database |
| GET | `/api/database/test-entities` | Retrieve all test entities from database |

## License

MIT
